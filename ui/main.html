<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Genie UI</title>
    <style>
        body { font-family: sans-serif; margin: 20px; background: #fafafa; }
        h1 { color: #5a2ee5; }
        pre { background: #eee; padding: 10px; border-radius: 5px; }
        .projects { display: flex; gap: 12px; flex-wrap: wrap; margin: 12px 0; }
        .card { background: white; border: 1px solid #ddd; border-radius: 8px; padding: 12px; cursor: pointer; box-shadow: 0 1px 2px rgba(0,0,0,0.04); }
        .card:hover { box-shadow: 0 2px 6px rgba(0,0,0,0.08); }
        .split { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
    </style>
</head>
<body>
    <h1>ðŸ§ž Genie Dashboard</h1>
    <p>Browse your local Genie projects and inspect their history.</p>
    <h2>Projects</h2>
    <div id="projects" class="projects"></div>

    <div id="project-view" style="display:none;">
        <h2 id="project-title"></h2>
        <div class="split">
            <div>
                <h3>Commits</h3>
                <pre id="project-commits"></pre>
            </div>
            <div>
                <h3>Tracked Files (latest)</h3>
                <pre id="project-files"></pre>
            </div>
        </div>
    </div>

    <script>
        async function loadProjects() {
            const res = await fetch('/api/projects');
            const projects = await res.json();
            const container = document.getElementById('projects');
            container.innerHTML = '';
            projects.forEach(p => {
                const card = document.createElement('div');
                card.className = 'card';
                card.innerHTML = `<strong>${p.name}</strong><br><small>${p.path}</small>`;
                card.onclick = () => openProject(p.name);
                container.appendChild(card);
            });
        }

        async function openProject(name) {
            document.getElementById('project-title').textContent = `Project: ${name}`;
            document.getElementById('project-view').style.display = 'block';
            const [commitsRes, filesRes] = await Promise.all([
                fetch(`/api/project/${encodeURIComponent(name)}/commits`),
                fetch(`/api/project/${encodeURIComponent(name)}/files`),
            ]);
            const [commits, files] = await Promise.all([commitsRes.json(), filesRes.json()]);
            document.getElementById('project-commits').textContent = JSON.stringify(commits, null, 2);
            document.getElementById('project-files').textContent = JSON.stringify(files, null, 2);
        }

        loadProjects();
    </script>
</body>
</html>